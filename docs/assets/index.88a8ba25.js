var P=Object.defineProperty;var I=(r,s,t)=>s in r?P(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var a=(r,s,t)=>(I(r,typeof s!="symbol"?s+"":s,t),t);const M=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};M();const g=0,f=1,b=2,m=3;var L;(function(r){r[r.Up=0]="Up",r[r.Right=1]="Right",r[r.Down=2]="Down",r[r.Left=3]="Left"})(L||(L={}));class ${constructor(s,t){a(this,"direction",1);a(this,"stringMode",!1);a(this,"width");a(this,"height");a(this,"halted",!1);a(this,"program",[]);a(this,"stdin");a(this,"x",0);a(this,"y",0);a(this,"stdinPos",0);a(this,"stack",[]);a(this,"stdout","");this.stdin=t;const i=s.split(/\n/g);this.width=i.reduce((e,n)=>n.length>e?n.length:e,0),this.height=i.length,i.forEach(e=>{if(e.length<this.width){const n=e+new Array(this.width-e.length+1).join(" ");this.program.push(Array.from(n))}else this.program.push(Array.from(e))})}nextStdinChar(){return this.stdinPos>=this.stdin.length?null:this.stdin.charAt(this.stdinPos++)}nextStdinNum(){if(this.stdinPos>=this.stdin.length)return-1;let s="";for(;this.stdin.charAt(this.stdinPos).match(/[0-9]/);)s+=this.stdin.charAt(this.stdinPos),this.stdinPos++;(this.stdin.charAt(this.stdinPos)===" "||this.stdin.charAt(this.stdinPos)===`
`)&&this.stdinPos++;const t=parseInt(s);return isNaN(t)?-1:t}nextPosition(){let s=this.x,t=this.y;switch(this.direction){case g:t=this.y-1<0?this.height-1:this.y-1;break;case b:t=(this.y+1)%this.height;break;case m:s=this.x-1<0?this.width-1:this.x-1;break;case f:s=(this.x+1)%this.width;break}this.x=s,this.y=t}step(){if(this.halted)return;const s=this.program[this.y][this.x];if(this.stringMode){s==='"'?this.stringMode=!1:this.stack.push(s.charCodeAt(0)),this.nextPosition();return}switch(s){case"v":this.direction=b;break;case">":this.direction=f;break;case"^":this.direction=g;break;case"<":this.direction=m;break;case"0":this.stack.push(0);break;case"1":this.stack.push(1);break;case"2":this.stack.push(2);break;case"3":this.stack.push(3);break;case"4":this.stack.push(4);break;case"5":this.stack.push(5);break;case"6":this.stack.push(6);break;case"7":this.stack.push(7);break;case"8":this.stack.push(8);break;case"9":this.stack.push(9);break;case"+":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(t+i);break}case"-":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(i-t);break}case"/":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(Math.floor(i/t));break}case"*":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(t*i);break}case"%":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(i%t);break}case"!":{(this.stack.pop()||0)===0?this.stack.push(1):this.stack.push(0);break}case"`":{const t=this.stack.pop()||0;(this.stack.pop()||0)>t?this.stack.push(1):this.stack.push(0);break}case"?":{const t=Math.random();t<.25?this.direction=g:t<.5?this.direction=f:t<.75?this.direction=b:this.direction=m;break}case"_":{(this.stack.pop()||0)===0?this.direction=f:this.direction=m;break}case"|":{(this.stack.pop()||0)===0?this.direction=b:this.direction=g;break}case":":{const t=this.stack.pop()||0;t===void 0?(this.stack.push(0),this.stack.push(0)):(this.stack.push(t),this.stack.push(t));break}case"\\":{const t=this.stack.pop()||0,i=this.stack.pop()||0;this.stack.push(t),this.stack.push(i);break}case"$":{this.stack.pop();break}case".":{const t=this.stack.pop()||0;this.stdout+=t+" ";break}case",":{const t=this.stack.pop()||0;this.stdout+=String.fromCharCode(t);break}case"#":{this.nextPosition();break}case"p":{const t=this.stack.pop()||0,i=this.stack.pop()||0,e=this.stack.pop()||0;this.program[t][i]=String.fromCharCode(e);break}case"g":{const t=this.stack.pop()||0,i=this.stack.pop()||0;if(i<this.width&&t<this.height){const e=this.program[t][i];this.stack.push(e.charCodeAt(0))}else this.stack.push(0);break}case"&":{this.stack.push(this.nextStdinNum());break}case"~":{const t=this.nextStdinChar()||"";if(t.length===0)return;this.stack.push(t.charCodeAt(0));break}case"@":{this.halted=!0;return}case'"':{this.stringMode=!0;break}}this.nextPosition()}}class N{constructor(s,t,i,e,n,p){a(this,"ticks",0);a(this,"start");a(this,"tbody");a(this,"currHighlight");this.interpreter=s,this.programEl=t,this.stackEl=i,this.stdinEl=e,this.stdoutEl=n,this.statsEl=p;let k='<table class="table table-dark table-bordered"><tbody id="table-body">';for(let x=0;x<this.interpreter.program.length;x++){const S=this.interpreter.program[x];k+="<tr>";for(let w=0;w<S.length;w++)k+=`<td>${S[w]}</td>`;k+="</tr>"}k+="</tbody></table>",this.programEl.innerHTML=k,this.tbody=document.getElementById("table-body"),this.currHighlight=document.querySelector("#table-body > tr > td"),this.currHighlight.className="highlight",this.renderStdin()}renderStdin(){if(!(this.interpreter.stdin.length>0))return;const{stdin:s,stdinPos:t}=this.interpreter;t<s.length?this.stdinEl.innerHTML=s.substring(0,t)+"<strong><u>"+s[t]+"</u></strong>"+s.substring(t+1):this.stdinEl.innerHTML=s+"<strong>EOF</strong>"}renderTick(){const{x:s,y:t}=this.interpreter;if(this.currHighlight.className="",this.tbody.children.length>t){const e=this.tbody.children[t];if(e.children.length>s){const n=e.children[s];this.currHighlight=n,n.classList.add("highlight")}}let i="";for(let e=this.interpreter.stack.length-1;e>=0;e--)i+=`<li class="list-group-item">${this.interpreter.stack[e]}</li>`;if(this.stackEl.innerHTML=i,this.stdoutEl.innerHTML=this.interpreter.stdout,this.renderStdin(),this.start||(this.start=performance.now()),this.ticks%50==0){const e=(performance.now()-this.start)/1e3,n=this.ticks/e;this.statsEl.innerText=`${n.toFixed(0)} OP/S`}this.ticks++}}let o=60;function h(r){const s=document.getElementById(r);if(!s)throw new Error(`No element exists for id ${r}`);return s}const d=h("start-stop"),A=h("program-display"),H=h("stack-display"),C=h("stdout"),T=h("stats"),O=h("stdin"),y=h("stdin-text"),v=h("script");let l,u,c;h("compile").addEventListener("click",()=>{c&&(clearInterval(c),c=void 0),l=new $(v.value,y.value),u=new N(l,A,H,O,C,T),d.innerText=`Start (${o})`});function E(){c&&clearInterval(c),c=setInterval(()=>{l.step(),u.renderTick(),l.halted&&clearInterval(c)},o)}d.addEventListener("click",()=>{if(c){clearInterval(c),c=void 0,d.innerText=`Start (${o})`;return}l.step(),u.renderTick(),E(),d.innerText=`Stop (${o})`});h("step").addEventListener("click",()=>{l.step(),u.renderTick()});h("speed-up").addEventListener("click",()=>{o=Math.max(0,Math.floor(o*.75)),c?(d.innerText=`Stop (${o})`,E()):d.innerText=`Start (${o})`});h("slow-down").addEventListener("click",()=>{o=Math.floor(o*1.25),c?(d.innerText=`Stop (${o})`,E()):d.innerText=`Start (${o})`});h("run").addEventListener("click",()=>{let r=0;const s=performance.now();for(;!l.halted;)l.step(),r++;const i=performance.now()-s,e=r/i;u.renderTick(),T.innerText=`Took ${i.toFixed(2)}ms, running at ${e.toFixed(0)} IPS. Total of ${r} operations.`});v.addEventListener("change",()=>{sessionStorage.setItem("program",v.value)});y.addEventListener("change",()=>{sessionStorage.setItem("stdin",y.value)});document.addEventListener("DOMContentLoaded",()=>{let r=sessionStorage.getItem("program"),s=sessionStorage.getItem("stdin");r&&(v.value=r),s&&(y.value=s),h("compile").click()});
