var S=Object.defineProperty;var E=(a,t,i)=>t in a?S(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var c=(a,t,i)=>(E(a,typeof t!="symbol"?t+"":t,i),i);const L=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const k of n.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&s(k)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}};L();const g=0,f=1,y=2,b=3;var x;(function(a){a[a.Up=0]="Up",a[a.Right=1]="Right",a[a.Down=2]="Down",a[a.Left=3]="Left"})(x||(x={}));const r={stackDirty:1,programDirty:2,stdinDirty:4,stdoutDirty:8};class P{constructor(t,i){c(this,"direction",1);c(this,"stringMode",!1);c(this,"width");c(this,"height");c(this,"halted",!1);c(this,"program",[]);c(this,"stdin");c(this,"x",0);c(this,"y",0);c(this,"stdinPos",0);c(this,"stack",[]);c(this,"stdout","");this.stdin=i;const s=t.split(/\n/g);this.width=s.reduce((e,n)=>n.length>e?n.length:e,0),this.height=s.length,s.forEach(e=>{if(e.length<this.width){const n=e+new Array(this.width-e.length+1).join(" ");this.program.push(Array.from(n))}else this.program.push(Array.from(e))})}nextStdinChar(){return this.stdinPos>=this.stdin.length?null:this.stdin.charAt(this.stdinPos++)}nextStdinNum(){if(this.stdinPos>=this.stdin.length)return-1;let t="";for(;this.stdin.charAt(this.stdinPos).match(/[0-9]/);)t+=this.stdin.charAt(this.stdinPos),this.stdinPos++;(this.stdin.charAt(this.stdinPos)===" "||this.stdin.charAt(this.stdinPos)===`
`)&&this.stdinPos++;const i=parseInt(t);return isNaN(i)?-1:i}nextPosition(){let t=this.x,i=this.y;switch(this.direction){case g:i=this.y-1<0?this.height-1:this.y-1;break;case y:i=(this.y+1)%this.height;break;case b:t=this.x-1<0?this.width-1:this.x-1;break;case f:t=(this.x+1)%this.width;break}this.x=t,this.y=i}step(){if(this.halted)return 0;let t=0;const i=this.program[this.y][this.x];if(this.stringMode)return i==='"'?this.stringMode=!1:(this.stack.push(i.charCodeAt(0)),t|=r.stackDirty),this.nextPosition(),t;switch(i){case"v":this.direction=y;break;case">":this.direction=f;break;case"^":this.direction=g;break;case"<":this.direction=b;break;case"0":this.stack.push(0),t|=r.stackDirty;break;case"1":this.stack.push(1),t|=r.stackDirty;break;case"2":this.stack.push(2),t|=r.stackDirty;break;case"3":this.stack.push(3),t|=r.stackDirty;break;case"4":this.stack.push(4),t|=r.stackDirty;break;case"5":this.stack.push(5),t|=r.stackDirty;break;case"6":this.stack.push(6),t|=r.stackDirty;break;case"7":this.stack.push(7),t|=r.stackDirty;break;case"8":this.stack.push(8),t|=r.stackDirty;break;case"9":this.stack.push(9),t|=r.stackDirty;break;case"+":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(s+e),t|=r.stackDirty;break}case"-":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(e-s),t|=r.stackDirty;break}case"/":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(Math.floor(e/s)),t|=r.stackDirty;break}case"*":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(s*e),t|=r.stackDirty;break}case"%":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(e%s),t|=r.stackDirty;break}case"!":{(this.stack.pop()||0)===0?this.stack.push(1):this.stack.push(0),t|=r.stackDirty;break}case"`":{const s=this.stack.pop()||0;(this.stack.pop()||0)>s?this.stack.push(1):this.stack.push(0),t|=r.stackDirty;break}case"?":{const s=Math.random();s<.25?this.direction=g:s<.5?this.direction=f:s<.75?this.direction=y:this.direction=b;break}case"_":{(this.stack.pop()||0)===0?this.direction=f:this.direction=b,t|=r.stackDirty;break}case"|":{(this.stack.pop()||0)===0?this.direction=y:this.direction=g,t|=r.stackDirty;break}case":":{const s=this.stack.pop()||0;s===void 0?(this.stack.push(0),this.stack.push(0)):(this.stack.push(s),this.stack.push(s)),t|=r.stackDirty;break}case"\\":{const s=this.stack.pop()||0,e=this.stack.pop()||0;this.stack.push(s),this.stack.push(e),t|=r.stackDirty;break}case"$":{this.stack.pop(),t|=r.stackDirty;break}case".":{const s=this.stack.pop()||0;this.stdout+=s+" ",t|=r.stackDirty|r.stdoutDirty;break}case",":{const s=this.stack.pop()||0;this.stdout+=String.fromCharCode(s),t|=r.stackDirty|r.stdoutDirty;break}case"#":{this.nextPosition();break}case"p":{const s=this.stack.pop(),e=this.stack.pop(),n=this.stack.pop();if(t|=r.stackDirty,s===void 0||e===void 0||n===void 0)break;this.program[s][e]=String.fromCharCode(n),t|=r.programDirty;break}case"g":{const s=this.stack.pop()||0,e=this.stack.pop()||0;if(e<this.width&&s<this.height){const n=this.program[s][e];this.stack.push(n.charCodeAt(0))}else this.stack.push(0);t|=r.stackDirty;break}case"&":{this.stack.push(this.nextStdinNum()),t|=r.stackDirty|r.stdinDirty;break}case"~":{const s=this.nextStdinChar()||"";if(!s.length)break;this.stack.push(s.charCodeAt(0)),t|=r.stackDirty|r.stdinDirty;break}case"@":return this.halted=!0,t;case'"':{this.stringMode=!0;break}}return this.nextPosition(),t}}class T{constructor(t,i,s,e,n,k){c(this,"ticks",0);c(this,"start");c(this,"tbody");c(this,"currHighlight");this.interpreter=t,this.programEl=i,this.stackEl=s,this.stdinEl=e,this.stdoutEl=n,this.statsEl=k,this.renderProgram(),this.renderStdin(),this.renderStack()}renderStdin(){if(!(this.interpreter.stdin.length>0))return;const{stdin:t,stdinPos:i}=this.interpreter;i<t.length?this.stdinEl.innerHTML=t.substring(0,i)+"<strong><u>"+t[i]+"</u></strong>"+t.substring(i+1):this.stdinEl.innerHTML=t+"<strong>EOF</strong>"}renderStack(){let t="";for(let i=this.interpreter.stack.length-1;i>=0;i--)t+=`<li class="list-group-item">${this.interpreter.stack[i]}</li>`;this.stackEl.innerHTML=t}renderProgram(){let t='<table class="table table-dark table-bordered"><tbody id="table-body">';for(let i=0;i<this.interpreter.program.length;i++){const s=this.interpreter.program[i];t+="<tr>";for(let e=0;e<s.length;e++)t+=`<td id="${e===this.interpreter.x&&i===this.interpreter.y?"highlight":""}">${s[e]}</td>`;t+="</tr>"}t+="</tbody></table>",this.programEl.innerHTML=t,this.tbody=document.getElementById("table-body"),this.currHighlight=document.querySelector("#highlight")}renderTick(t){if(t&r.programDirty)this.renderProgram();else{const{x:i,y:s}=this.interpreter;if(this.currHighlight.id="",this.tbody.children.length>s){const e=this.tbody.children[s];if(e.children.length>i){const n=e.children[i];this.currHighlight=n,n.id="highlight"}}}if(t&r.stdoutDirty&&(this.stdoutEl.innerHTML=this.interpreter.stdout),t&r.stdinDirty&&this.renderStdin(),t&r.stackDirty&&this.renderStack(),this.start||(this.start=performance.now()),this.ticks%60==0){const i=(performance.now()-this.start)/1e3,s=this.ticks/i;this.statsEl.innerText=`${s.toFixed(0)} OP/S`}this.ticks++}}let h=60;function o(a){const t=document.getElementById(a);if(!t)throw new Error(`No element exists for id ${a}`);return t}const l=o("start-stop"),I=o("program-display"),M=o("stack-display"),$=o("stdout"),w=o("stats"),A=o("stdin"),m=o("stdin-text"),D=o("script");let p,u,d;o("compile").addEventListener("click",()=>{d&&(clearInterval(d),d=void 0),p=new P(D.value,m.value),u=new T(p,I,M,A,$,w),l.innerText=`Start (${h})`});function v(){d&&clearInterval(d),d=setInterval(()=>{const a=p.step();u.renderTick(a),p.halted&&clearInterval(d)},h)}l.addEventListener("click",()=>{if(d){clearInterval(d),d=void 0,l.innerText=`Start (${h})`;return}const a=p.step();u.renderTick(a),v(),l.innerText=`Stop (${h})`});o("step").addEventListener("click",()=>{const a=p.step();u.renderTick(a)});o("speed-up").addEventListener("click",()=>{h=Math.max(0,Math.floor(h*.75)),d?(l.innerText=`Stop (${h})`,v()):l.innerText=`Start (${h})`});o("slow-down").addEventListener("click",()=>{h=Math.floor(h*1.25),d?(l.innerText=`Stop (${h})`,v()):l.innerText=`Start (${h})`});o("run").addEventListener("click",()=>{let a=0;const t=performance.now();for(;!p.halted;)p.step(),a++;const s=performance.now()-t,e=a/s;u.renderTick(r.programDirty|r.stackDirty|r.stdinDirty|r.stdoutDirty),w.innerText=`Took ${s.toFixed(2)}ms, running at ${e.toFixed(0)} IPS. Total of ${a} operations.`});D.addEventListener("change",()=>{sessionStorage.setItem("program",D.value)});m.addEventListener("change",()=>{sessionStorage.setItem("stdin",m.value)});document.addEventListener("DOMContentLoaded",()=>{let a=sessionStorage.getItem("program"),t=sessionStorage.getItem("stdin");a&&(D.value=a),t&&(m.value=t),o("compile").click()});
